---
title: "Awaitableの使いどころとしてWebビルド対応Unityパッケージがありそう"
emoji: "🚦"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["unity", "unity6", "csharp", "awaitable", "asyncawait"]
published: false
---

## はじめに

### TL;DR

- Unity6 以降の
- Web ビルドをターゲットに含む
- Unity パッケージ

<!-- textlint-disable -->
という条件の環境で Awaitable が使えると嬉しいかもしれないと考えた。
<!-- textlint-enable -->

### 概要

<!-- textlint-disable -->
本記事は Unity6(2023)から使える新機能である Awaitable について、
その使いどころを考えてみた内容です。
趣旨として「こうするべきだ！」というような主張をするような意図はなく、
それこそお風呂に入ってるとき「Awaitable ってどこで使えるんだろうなぁ」と考えてた時に思いついた内容を書いてみたものです。
<!-- textlint-enable -->

まだ新しい機能なのと、筆者も使い込んでいるわけではないので、
もし間違った内容を書いてしまっていたらご指摘いただけると幸いです。
また、Unity6 は LTS がリリースされているものの、
Awaitable の機能は今後も強化されていく可能性がありますので、
あくまで執筆現在（2024/12）の情報であることにご注意ください。

### 検証環境

- Windows 10 Home
- Unity 6000.0.31f1
- Chrome for Windows 131.0.6778.140

### サンプル

サンプルコードを次の GitHub リポジトリ及び GitHub Pages で公開しております。

https://github.com/drumath2237/Web-Awaitable-testbed

## Unity Webビルドにおける課題

Unity はもともと WebGL 向けにプロジェクトをビルドできますが、Unity6 からは WebGPU にも対応されたことにより「Web ビルド」と名称が統一されました。
本記事でもその名前に沿ってお話ししますが、こちらはいわゆる従来の「WebGL ビルド」と基本的には変わらないものを指しています。

Unity の Web ビルドは結構特殊な環境ということもあり、色々な罠・ツラみがあります。
例えばランタイムでバッグがしにくかったり、ビルドが遅かったりといったものがありますね。
上記に加え、個人的に結構つらいなって感じるのが「マルチスレッドを使う Task が動かない」問題です。
Task と言えば C#言語がサポートしている非同期処理の仕組みで、async/await を使って非同期な処理を同期的に記述できる手軽さが売りです。
多くの Unity プロジェクトで非同期処理を扱う時に Task を使うことが多いですが、残念ながら Web ビルドはマルチスレッドをサポートしておらず、一部の Task の API が使用できません。代表的なものは`Task.Delay`でしょうか。

ネット上では、この Task を使わない非同期処理として次の 2 つを紹介していることが多いです。

- UniTask
- Coroutine

Unity アプリ開発者で一番多く使われているのは、UniTask で代替する方法でしょう。
UniTask は、より Unity のシステムにあった Task を提供する目的で開発されており、非同期処理は PlayerLoop で実行されるなどの工夫がなされています。
そのため、明示的に呼び出さない限りはシングルスレッドで動作することで Web ビルドでもちゃんと動作します。
UniTask は非常に高機能なライブラリなためエンタープライズでの採用例も多く、入れられるなら入れておくのが吉と言えるものですが、サードーパーティライブラリである点を考慮する必要があります。
もしかしたら会社や対応プラットフォームの都合で使えない可能性があったり、Unity ライブラリを作る場合にはなるべく他のサードパーティに依存したくないという気持ちがありますね。

Coroutine も Unity で使える非同期処理の仕組みで、UniTask や Task が使える前から存在する方法です。
こちらもプレイヤーループベースの仕組みではありますが、Task/UniTask と違い、デフォルトで async/await に対応していなかったり値が返せなかったりと、機能面で劣ります。
筆者ももうしばらき Coroutine を使っていないですし、よっぽどの理由がない限りは UniTask を使いたい気持ちでいます。

## Awaitableがいい感じかもと思った

## おわりに

### 参考文献