---
title: "pnpmã§ä½œã£ãŸWebãƒ•ãƒ­ãƒ³ãƒˆã‚’GitHub Actionsã§GitHub Pagesã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹"
emoji: "ğŸš€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["pnpm", "github", "githubactions", "githubpages", "vite"]
published: false
---

:::message
ã“ã®è¨˜äº‹ã¯[ã«ãƒ¼å…„ã•ã‚“ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼2023](https://qiita.com/advent-calendar/2023/ninisan_solo) ã® 12 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚
:::

## ã¯ã˜ã‚ã«

### TL;DR

ã“ã¡ã‚‰ã‚’ãŠä½¿ã„ãã ã•ã„ã€‚

https://github.com/drumath2237/pnpm-ghactions-ghpages-demo/blob/main/.github/workflows/deploy.yml

### æ¦‚è¦ã¨å¯¾è±¡èª­è€…

æœ¬è¨˜äº‹ã§ã¯ç­†è€…ãŒ Web ãƒ•ãƒ­ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ã¨ãã«ã‚ˆãä½¿ã£ã¦ã„ã‚‹æŠ€è¡“æ§‹æˆã§ã® tips ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚pnpm ã¨ Vite ã‚’ä½¿ã£ãŸã‚·ãƒ³ãƒ—ãƒ«ãª Web ãƒ•ãƒ­ãƒ³ãƒˆã‚’ GitHub Actions çµŒç”±ã§ GitHub Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚ç°¡å˜ãªãƒ‡ãƒ¢ã‚’ä½œã‚‹ã¨ãã«ã‚ˆãä½¿ã†æ–¹æ³•ãªã®ã§å‚™å¿˜éŒ²çš„ã«ã¾ã¨ã‚ã‚ˆã†ã¨è€ƒãˆã¾ã—ãŸã€‚

å¯¾è±¡èª­è€…ã¯æ¬¡ã®é€šã‚Šã§ã™ãŒã€å½“ã¦ã¯ã¾ã‚‰ãªãã¦ã‚‚å•é¡Œã¯ãªã„ã§ã™ã€‚

- Web ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ã¤ã„ã¦åŸºç¤çŸ¥è­˜ãŒã‚ã‚‹
- Node.js ã‚„ npm ã‚’ä½¿ã£ãŸé–‹ç™ºçµŒé¨“ãŒã‚ã‚‹
- GitHub ã‚’ä½¿ã£ã¦ã„ã‚‹

ã¾ãŸã€ä»¥é™ã¯ GitHub Actions ã‚’ Actionsã€GitHub Pages ã‚’ Pages ã¨çœç•¥ã—ã¦è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

### æ¤œè¨¼ç’°å¢ƒ

- Windows 11 Home
- pnpm 8.12.1
- Node.js 18.17.1
- Vite 5

### ã‚µãƒ³ãƒ—ãƒ«

æœ¬è¨˜äº‹ã®å†…å®¹ã«æ²¿ã£ã¦ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ GitHub ã«ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã®ã§ã€ã”å‚è€ƒã«ãªã•ã£ã¦ãã ã•ã„ã€‚

https://github.com/drumath2237/pnpm-ghactions-ghpages-demo

## GitHub Pagesã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¾ã§

ãã‚Œã§ã¯ç°¡å˜ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ Pages ã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¾ã§ã‚’è¿½ã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### ç°¡å˜ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ãƒ‡ãƒ¢ç”¨ã®ç°¡å˜ãªä¾‹ã¨ã—ã¦ create-vite CLI ã«ã‚ˆã£ã¦ã¤ãã‚‰ã‚Œã‚‹ Vue3/TypeScript ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã—ã¾ã—ãŸã€‚

```bash
pnpm create vite@latest
```

ã„ãã¤ã‹è³ªå•ã•ã‚Œã¾ã™ãŒã€Vue ã¨ TypeScript ã‚’é¸æŠã—ã¾ã—ãŸã€‚ã“ã“ã¯å‰²ã¨ä½•ã§ã‚‚ã„ã„ã§ã™ãŒã€ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®å‡ºåŠ›å…ˆãªã©ãŒé•ã†ãŸã‚ã€Actions ã®è¨­å®šã‚’é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚
ã“ã®æ™‚ç‚¹ã§ dev ã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![Alt text](/images/pnpm-actions-pages/pnpmdev.png)

ä»Šå›ã¯ Web ãƒ•ãƒ­ãƒ³ãƒˆå´ã®ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã›ãšã«ã“ã®ã¾ã¾ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

### base urlã®è¨­å®šã‚’ã™ã‚‹

Vite ã« base url ã®è¨­å®šã‚’ã—ã¾ã™ã€‚ã“ã‚Œã¯ GitHub Pages ãŒ`user.github.io/<project name>`ã¨ã„ã† URL ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ãŸã‚å¿…è¦ãªè¨­å®šã§ã™ã€‚ã“ã®è¨­å®šã‚’ã—ãªã„ã¨é™çš„ã‚¢ã‚»ãƒƒãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã™ã‚‹ã®ã§æ°—ã‚’ä»˜ã‘ã¦ãã ã•ã„ã€‚`pnpm build && pnpm run preview`ã‚’å®Ÿè¡Œã—ã¦`http://localhost:4173/hogehoge/`ã¨ã„ã†ãƒšãƒ¼ã‚¸ãŒé–‹ã‘ã°å•é¡Œãªã„ã§ã—ã‚‡ã†ã€‚

`vite.config.ts`ã‚’ç·¨é›†ã—ã¦æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

```ts:vite.config.ts
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => {
  if (mode === "production") {
    return {
      base: "/pnpm-ghactions-ghpages-demo/", // ãƒªãƒã‚¸ãƒˆãƒªåã‚’æŒ‡å®š
      plugins: [vue()],
    };
  }
  return {
    plugins: [vue()],
  };
});
```

`mode`ã«ã‚ˆã£ã¦æœ¬ç•ªãƒ“ãƒ«ãƒ‰ãªã®ã‹é–‹ç™ºç”¨ãªã®ã‹ã‚’åˆ¤åˆ¥ã—ã¦ã„ã¾ã™ã€‚

### ã‚¸ãƒ§ãƒ–ã‚’çµ„ã‚€

`.github/workflows/`ä»¥ä¸‹ã« YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã— Actions ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚mian ãƒ–ãƒ©ãƒ³ãƒã¸ push ã—ãŸéš›ã«ã€æ¬¡ã«ç¤ºã™ã‚ˆã†ãªå‡¦ç†ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§å®Ÿç¾ã—ãŸã„ã§ã™ã€‚

1. å®Ÿè¡Œãƒã‚·ãƒ³ä¸Šã« pnpmãƒ»Node.js ãªã©ã®ç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
2. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è§£æ±º
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰
4. GitHub Pages ã¸ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤


æœ€çµ‚çš„ã«æ¬¡ã«ç¤ºã™ã‚ˆã†ãª YAML ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºæ¥ä¸ŠãŒã‚Šã€ã„ã¤ã‚‚ã“ã®å†…å®¹ã‚’æµç”¨ã—ã¦ã„ã¾ã™ã€‚

```yaml:.github/workflows/deploy.yml
# Simple workflow for deploying static content to GitHub Pages
name: Deploy

on:
  # Runs on pushes targeting the default branch
  push:
    branches: ["main"]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # Single deploy job since we're just deploying
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20.x
          cache: "pnpm"

      - name: Install dependencies
        run: pnpm install

      - run: pnpm build

      - name: Setup Pages
        uses: actions/configure-pages@v3

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          # Upload entire repository
          path: "./dist"

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
```

ã“ã® YAML ãƒ•ã‚¡ã‚¤ãƒ«ã¯ GitHub Actions å…¬å¼ãŒæä¾›ã—ã¦ã„ã‚‹ Static HTML ã¨ã„ã†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã€pnpm ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¼‰ã£ã¦ã„ã‚‹å†…å®¹ã‚’åˆã‚ã›ãŸã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://pnpm.io/ja/continuous-integration#github-actions

### GitHub Pagesã‚’æœ‰åŠ¹åŒ–ã™ã‚‹

æœ€å¾Œã«ãƒªãƒã‚¸ãƒˆãƒªã®è¨­å®šã§ Actions ã«ã‚ˆã‚‹ Pages ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ŒDeploy from a branchã€ã«ãªã£ã¦ã„ã¾ã™ãŒã“ã‚Œã‚’ã€ŒGitHub Actionsã€ã«å¤‰æ›´ã—ã¾ã—ã‚‡ã†ã€‚

![Alt text](/images/pnpm-actions-pages/change-pages.png)

ã™ã‚‹ã¨ Actions ãŒã‚¸ãƒ§ãƒ–ãŒå‹•ãã€Pages ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæˆåŠŸã—ã¾ã—ãŸã€‚

![Alt text](/images/pnpm-actions-pages/successactions.png)

## ãŠã‚ã‚Šã«

### ã¾ã¨ã‚

### å‚è€ƒæ–‡çŒ®
