---
title: "Babylon.js 6.31.0でWebXR Raw Camera Access Featureが追加された"
emoji: "📷"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["babylonjs", "webxr", "ar"]
published: false
---

# はじめに

## TL;DR

## 概要と対象読者

タイトルどおりではありますが、Babylon.js に最近追加された WebXR 機能である Raw Camera Access についてご紹介します。分量としては軽い内容ですが、少々内容のコンテキストが高めに思われる可能性がありますのでご了承ください。具体的には下記のトピックについて取り扱いますので、これらについて基礎知識があると読みやすいでしょう。

- Babylon.js
- WebXR Device API
- WebXR Raw Camera Access Module

## 検証環境

本記事の執筆において利用した環境を次に示します。

- Windows 10 Home
- Node.js 20
- pnpm 8
- Babylon.js 6.33.0

## サンプル

本記事で紹介した内容を実装したサンプルを GitHub にて公開しております。
もしよければ、合わせてご覧ください。

https://github.com/drumath2237/babylon-webxr-raw-camera-access-sandbox

# RawCameraAccessについてご紹介

## WebXR Raw Camera Access Moduleについて

今回ご紹介する WebXR Raw Camera Access Feature というものは、Babylon.js における WebXR Feature の一種です。Babylon.js では WebXR Device API によって提供される Module を、Feature という形でラップして提供します。Feature（Module）の他の例としては Light Estimation（光源推定）や Plane Detection（平面検出）、Hit Test などがあります。

実は WebXR Raw Camera Access Module については以前に記事を書いていますので、詳しくはそちらをご覧ください。当時は Babylon.js に機能としてなかったため、自分で初期化やデータ変換をする必要がありましたが、この度それがなくなったので嬉しいです。

https://zenn.dev/drumath2237/articles/52d62638c7d06f

## Featureによって何ができるのか

さてこの Feature ですが、日本語に直訳すると「生のカメラへのアクセス」ということになります。つまり WebXR 機能としてカメラの情報を直接取得できる機能ということです。API ドキュメントページを次に貼ります。

https://doc.babylonjs.com/typedoc/classes/BABYLON.WebXRRawCameraAccess

この Feature 独自の API は多くないです。ざっくりこの API を通して得られるカメラ情報というのは次の 2 つです。順番に見ていきましょう。

- カメラ画像
- カメラ内部パラメータ

### カメラ画像

カメラ画像に関係する API は次の 2 つです。

- texturesData
- onTexturesUpdatedObservable

`textureData`はカメラ画像のテクスチャ（`BaseTexture`型）の配列です。なぜ配列かというと、VRHMD のような 2 眼のデバイスがあった場合にテクスチャを複数取れる可能性があるからですね。
`onTexturesUpdatedObservable`はカメラ画像テクスチャが更新されたときに呼び出される Observable オブジェクトです。ここにコールバックを登録してカメラ画像を取得処理を入れることになりそうです。

### カメラ内部パラメータ

カメラ内部パラメータとは、カメラのレンズ特性を示す数値の配列です。ここでは詳しい解説はしませんが、いわゆる視野角などに関わってくる値です。

https://mem-archive.com/2018/02/21/post-157/

Raw Camera Access Feature では`cameraIntrinsics`というプロパティから「内部パラメータの配列」を取得出来ます。配列な理由はすでに説明済みですね。このプロパティの方は次のようになっており、各フィールドが主要なパラメータと対応しています（筆者もうまく説明できない部分はコメントをしていません）。

```ts
{
  ax: number;        // 水平焦点距離
  ay: number;        // 垂直焦点距離
  gamma: number;
  height: number;    // 画像の高さ
  u0: number;        // 水平光学中心
  v0: number;        // 垂直光学中心
  viewportX: number;
  viewportY: number;
  width: number;     // 画像の横幅
}
```

## 実装と動作確認

# おわりに

## まとめ

## 参考
