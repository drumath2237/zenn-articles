---
title: "WebXRã§ã‚«ãƒ¡ãƒ©æƒ…å ±ã‚’å–å¾—ã§ãã‚‹Raw Camera Accessã«ã¤ã„ã¦ã®èª¿æŸ»éŒ²"
emoji: "ğŸ“¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["webar", "babylonjs", "webgl", "typescript", "ar"]
published: false
---

# ã¯ã˜ã‚ã«

## TL;DR

## æ¦‚è¦

ã“ã®è¨˜äº‹ã¯[WebXR ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼]()ã®ã€‡æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

ç§ã¯ WebAR ã‚’ä½¿ã£ãŸé–‹ç™ºã‚’ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ã™ãŒã€
ãã®ä¸­ã§ã€Œã‚«ãƒ¡ãƒ©ã®æƒ…å ±ã‚’å–å¾—ã—ãŸã„ã€ã¨ã„ã†èª²é¡Œã‚’æŠ±ãˆã¦ãŠã‚Šã€
è‰²ã€…èª¿ã¹ã¦ç™ºè¦‹ã—ãŸè¬ã® WebXR Raw Camera Access Feature ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

## æ‰±ã†å†…å®¹

æœ¬è¨˜äº‹ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã‚’æ‰±ã„ã¾ã™ã€‚

- WebXR Raw Camera Access API ã®æ¦‚è¦
- Raw Camera Access API ã®ç¾çŠ¶
- Babylon.js ã‚’ä½¿ã£ãŸä½¿ç”¨æ–¹æ³•

ã¾ãŸã€ä»Šå›ã®è¨˜äº‹ã§ã¯æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã®åŸºæœ¬äº‹é …ã‚’ç¢ºèªã›ãšã«ä½¿ç”¨ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
ã—ãŸãŒã£ã¦åŸºæœ¬çš„ãª Web ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®çŸ¥è­˜ã‚„ 3DCG ã®çŸ¥è­˜ã€TypeScript ã®æ–‡æ³•ãªã©ã‚’
ç†è§£ã—ã¦ã„ã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ã§ã™ã€‚

## å¯¾è±¡èª­è€…

ä»¥ä¸‹ã«ç¤ºã™ã‚ˆã†ãªæ–¹ã«ã¯ã€æœ¬è¨˜äº‹ã§è§¦ã‚Œã‚‹å†…å®¹ãŒå½¹ã«ç«‹ã¤ã¨è€ƒãˆã¾ã™ã€‚

- WebAR ã§ã‚«ãƒ¡ãƒ©ç”»åƒã‚’å–å¾—ã—ãŸã„äºº
- WebXR Device API ã§ä½•ãŒã§ãã‚‹ã®ã‹ã‚’çŸ¥ã‚ŠãŸã„äºº

ã¾ãŸè©³ç´°ã¯å¾Œè¿°ã—ã¾ã™ãŒã€ä»Šå›æ‰±ã† API ã¯**ã‹ãªã‚Šæœ€è¿‘å‡ºã¦ããŸå®Ÿé¨“çš„ãª API**ã§ã™ã€‚
è©¦ã™ã¨ãã¯è‡ªå·±è²¬ä»»ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚
ãã—ã¦ 2021 ã­ã‚“ 1 æœˆç¾åœ¨ã€ã“ã® API ãŒä½¿ãˆã‚‹ã®ã¯ Chrome for Android ã®ã¿ã¨ç™ºè¡¨ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€
iOS ã§ WebXR ã‚’ã‚„ã‚‰ã‚Œã¦ã„ã‚‹æ–¹ã¯ã”ã‚ã‚“ãªã•ã„ã€‚

## æƒ³å®šç’°å¢ƒ

ç­†è€…ãŒç”¨ã„ãŸç’°å¢ƒã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

- é–‹ç™ºæ©Ÿï¼šWindows 10 Home
- ãƒ‡ãƒãƒƒã‚°æ©Ÿï¼šPixel 4a 5Gï¼ˆAndroid12ï¼‰, Nexus 5Xï¼ˆAndroid8.1ï¼‰
- Node.js 16.x
- Babylon.js **5.0.0.preview-60**
- TypeScript
- Vite 2

# Raw Camera Access ã®ç¾çŠ¶èª¿æŸ»

## Raw Camera Access ã¨ã¯ã„ã£ãŸã„ä½•ã‹

WebXR Raw Camera Access Feature ã¨ã¯ã€ãã®åã®é€šã‚Š
WebXR Device API çµŒç”±ã§ã‚«ãƒ¡ãƒ©ç”»åƒãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’å–å¾—ã—ã€
ãã‚Œã‚’ WebAR ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§åˆ©ç”¨ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã€‚

https://chromestatus.com/feature/5759984304390144

ãªã‚“ã ã‹æ™®é€šã«å®Ÿè£…ã•ã‚Œã¦ãã†ãªæ©Ÿèƒ½ã§ã™ãŒã€
å®Ÿã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è¦³ç‚¹ã‹ã‚‰é•·ã‚‰ãå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚
ä»£æ›¿ã¨ã—ã¦ getUserMedia ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ãŒã€
æ™®é€šã«ã‚¹ãƒãƒ›ã§ã‚„ã£ã¦ã—ã¾ã†ã¨ getUserMedia ã¨ WebXR Device API ãŒã‚«ãƒ¡ãƒ©ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å¥ªã„åˆã£ã¦ã—ã¾ã†ãŸã‚
å³ã—ã„é¸æŠã§ã™ã€‚

ä¸Šã«è¼‰ã›ãŸ Chrome Platform Status ã® Platform Support Explanation ã®ä¸€éƒ¨ã‚’å¼•ç”¨ã—ã¾ã™ã€‚

> This will be supported on platforms where Chrome supports AR. Currently, this is only Android. WebView support is planned. There are no technical restrictions specific to this API preventing it from being implemented on other platforms.

ã“ã‚Œã«ã‚ˆã‚‹ã¨ã€Raw Camera Access Feature ã¯
AR ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ Chrome ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹äºˆå®šã§ã‚ã‚Šã€
ç¾åœ¨(2021/11/27)æ™‚ç‚¹ã§ã¯ Chrome for Android ã®ã¿ã¨ã®ã“ã¨ã§ã™ã€‚

## API ã®æƒ…å ±æ•´ç†ã¨åˆ©ç”¨å¯èƒ½æ€§

ã‚‚ã¨ã‚‚ã¨ Raw Camera Access ã¯æ¬¡ã® GitHub ã«ææ¡ˆå†…å®¹ãŒã‚ã‚Šã¾ã—ãŸã€‚
æœ€çµ‚ã‚³ãƒŸãƒƒãƒˆãŒ 2021 å¹´ã® 6 æœˆãªã®ã§ã€Raw Camera Access ãŒå®Ÿé¨“çš„ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹å‰ã§ã™ã­ã€‚

https://github.com/immersive-web/raw-camera-access/blob/main/explainer.md

ã“ã®ææ¡ˆå†…å®¹ã®ä¸­ã«ã¯ã€ã™ã§ã« Raw Camera Access ã‚’æœ‰åŠ¹ã«ã™ã‚‹æ–¹æ³•ã‚„ã€
ãã‚Œã‚’ä½¿ã£ã¦ã‚«ãƒ¡ãƒ©ç”»åƒã¨ã‚«ãƒ¡ãƒ©å†…éƒ¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨ˆç®—ãƒ»å–å¾—ã™ã‚‹æ–¹æ³•ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚
å…·ä½“çš„ã«å†…å®¹ã‚’æŠœç²‹ã—ã¦ã¿ã¾ã™ã€‚

ã¾ãš Raw Camera Access ã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã«ã¯ã€
XRSession ã‚’å–å¾—ã™ã‚‹éš›ã« feature ã¨ã—ã¦`"camera-access"`ã‚’ require ã—ã¾ã™ã€‚

```js:GitHubã‚ˆã‚ŠæŠœç²‹
const session = await navigator.xr.requestSession("immersive-ar", {
  requiredFeatures: ["camera-access"]
});
```

ãã—ã¦ã‚«ãƒ¡ãƒ©ç”»åƒã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚

```js:GitHubã‚ˆã‚ŠæŠœç²‹ï¼ˆã¡ã‚‡ã£ã¨æ”¹å¤‰ï¼‰
// ... in rAFcb ...
let viewerPose = xrFrame.getViewerPose(xrRefSpace);
for (const view of viewerPose.views) {
  if (view.camera) {
    const cameraTexture = binding.getCameraImage(view.camera);
  }
}
```

æœ€çµ‚çš„ã«`cameraTexture`ã«æ ¼ç´ã•ã‚ŒãŸã‚‚ã®ãŒã‚«ãƒ¡ãƒ©ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ãªã‚Šã¾ã™ã€‚
ã“ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¯`WebGLTexture`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã€WebGL API ã§æ‰±ã†ã“ã¨ãŒã§ãã‚‹ç”»åƒãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚

ã¾ãŸã‚³ãƒ¡ãƒ³ãƒˆã§ã‚‚è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹é€šã‚Šã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯
`xrSession.requestAnimationFrame`ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã§å®Ÿè¡Œã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯é€šå¸¸ã® Web API ã® requestAnimationFrame ã¨ã¯ç•°ãªã‚Šã€WebXR å°‚ç”¨ã®ã‚‚ã®ã§ã™ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

ã“ã®ã‚³ãƒ¼ãƒ‰ä¸­ã«å­˜åœ¨ã™ã‚‹`view.camera`ã‚„`binding.getCameraImage`ãªã©ã¯
é€šå¸¸å‹å®£è¨€ã«ã¯çµ„ã¾ã‚Œã¦ã„ãªã„ãŸã‚ã€TypeScript ã§æ‰±ã†å ´åˆã‚„å‹è£œå®Œã‚’åŠ¹ã‹ã›ãŸã„å ´åˆã«ã¯
å‹å®£è¨€ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®ä¾‹ã‚’æ¬¡ã«æŠœç²‹ã—ã¾ã™ã€‚

```ts:GitHubã‚ˆã‚ŠæŠœç²‹
partial interface XRView {
  // Non-null iff there exists an associated camera that perfectly aligns with the view:
  [SameObject] readonly attribute XRCamera? camera;
};

interface XRCamera {
  // Dimensions of the camera image:
  readonly attribute long width;
  readonly attribute long height;
};

partial interface XRWebGLBinding {
  // Access to the camera texture itself:
  WebGLTexture? getCameraImage(XRCamera camera);
};
```

<!-- intrinsicsã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ã“ã¡ã‚‰ã« -->

## Babylon.jsã§ã®åˆ©ç”¨

<!-- ã‚µãƒ³ãƒ—ãƒ«ã¾ã§ã¯ç”¨æ„ã§ããªã‹ã£ãŸãŒ -->
<!-- Babylon.jsã§ã©ã‚“ãªæ„Ÿã˜ã§ä½¿ãˆã‚‹ã®ã‹ã‚’ã•ã‚‰ã£ã¨æ›¸ã -->

## ä½¿ç”¨æ™‚ã®æ³¨æ„

<!-- WebXR Incubationã‚’æœ‰åŠ¹ã«ä»•æ§˜ã­ã£ã¦ã“ã¨ -->


# ãŠã‚ã‚Šã«

## å‚è€ƒæ–‡çŒ®
