---
title: "Viteã®libraryãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã¿ã‚‹"
emoji: "ğŸ“¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vite", "npm", "typescript", "web"]
published: true
---

:::message
æœ¬è¨˜äº‹ã¯[ã«ãƒ¼å…„ã•ã‚“ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼2023](https://qiita.com/advent-calendar/2023/ninisan_solo)ã®14æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚
:::

## ã¯ã˜ã‚ã«

### TL;DR

Vite ã® library ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã†ã¨ã€ç°¡å˜ãªãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘ npm ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¯”è¼ƒçš„æ¥½ã«ä½œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### æ¦‚è¦ã¨å¯¾è±¡èª­è€…

æœ€è¿‘ç­†è€…ã¯ [luma-splatting-for-babylonjs](https://github.com/drumath2237/luma-splatting-for-babylonjs) ã¨ã„ã† npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã—ã¾ã—ãŸã€‚ã“ã® npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯æ©Ÿèƒ½çš„ã«ã¯ã™ã”ã„ã‚·ãƒ³ãƒ—ãƒ«ãªã®ã§ã‚µã‚¯ãƒƒã¨å…¬é–‹ã—ãŸã„ã¨è€ƒãˆã¦ãŠã‚Šã€ãã®éš›ã« create-vite CLI ã§ä½¿ãˆã‚‹ library ã¨ã„ã†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã£ã¦è¦‹ãŸã¨ã“ã‚çµæ§‹è‰¯ã‹ã£ãŸã®ã§ã”ç´¹ä»‹ã—ã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã”ç´¹ä»‹ã™ã‚‹å†…å®¹ã«ã¯ Node.js ã‚„ npmï¼ˆpnpmï¼‰ã€Viteã€TypeScript ã¨ã„ã£ãŸãƒ„ãƒ¼ãƒ«ãŒç™»å ´ã—ã¾ã™ã€‚ã‚ã‚‹ç¨‹åº¦ã“ã‚Œã‚‰ã«ã¤ã„ã¦çŸ¥è­˜ãŒã‚ã‚‹ã¨èª­ã¿ã‚„ã™ã„ã§ã—ã‚‡ã†ã€‚
æœ¬è¨˜äº‹ã®èª­è€…åƒã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚

- npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã£ã¦å…¬é–‹ã—ã¦ã¿ãŸã„
- TypeScript ã‚’ä½¿ã£ã¦ Web ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚’ã—ã¦ã„ã‚‹ãƒ»ã—ãŸã“ã¨ãŒã‚ã‚‹
- Vite ã‚’ä½¿ã£ã¦ã„ã‚‹

ã“ã‚Œã‚‰ã«ã¤ã„ã¦ã¯å®Œå…¨ã«å½“ã¦ã¯ã¾ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã®ã§ã€ãŠæ°—è»½ã«èª­ã‚“ã§ã„ãŸã ã‘ã‚Œã°å¬‰ã—ã„ã§ã™ã€‚ã¾ãŸã€æœ¬è¨˜äº‹ã§ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã« pnpm ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã®ã§ã€ã”è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚

### æ¤œè¨¼ç’°å¢ƒ

è¨˜äº‹ã®åŸ·ç­†ã«ãŠã„ã¦ç”¨ã„ãŸæ¤œè¨¼ç’°å¢ƒã‚’æ¬¡ã«ç¤ºã—ã¾ã™ã€‚

- Windows 10 Home
- Node.js 20.9.0
- pnpm 8.12.1
- Vite 5.0.10

### ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

æœ¬è¨˜äº‹ã®å†…å®¹ã«æ²¿ã£ã¦ä½œæˆã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ GitHub ã«ã¦å…¬é–‹ã—ã¦ãŠã‚Šã¾ã™ã®ã§ã€åˆã‚ã›ã¦ã”è¦§ãã ã•ã„ã€‚

https://github.com/drumath2237/ninisan-demo-library

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¨ãƒ­ã‚¸ãƒƒã‚¯ã®è¨˜è¿°

ãã‚Œã§ã¯ npm ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã¾ãšã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæœ¬ä½“ã®ä½œæˆã‹ã‚‰ç€æ‰‹ã—ã¾ã™ã€‚

### create-vite CLIã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

:::message
ã“ã“ã§ã¯åŸ·ç­†æ™‚ç‚¹ï¼ˆ2023/12/31ï¼‰ã®æœ€æ–°ç‰ˆã®ç’°å¢ƒã‚’ç”¨ã„ã¦æ¤œè¨¼ã—ã¦ã„ã¾ã™ã€‚
Viteã®CUIã¯å¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚
:::

Vite ã‚’ä½¿ã£ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹éš›ã«ã¯ create-vite ã¨ã„ã† CLI ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦ create-vite ã‚’èµ·å‹•ã—ã¾ã—ã‚‡ã†ã€‚

```bash
pnpm create vite@latest
```

ã™ã‚‹ã¨ã„ãã¤ã‹é¸æŠè‚¢ãŒç¾ã‚Œã¾ã™ã®ã§ã€ã€ŒOthersã€ã‚’é¸æŠã—ã¾ã™ã€‚

![Alt text](/images/vite-library-npm/create-vite.png)
*Ohtersã‚’é¸æŠ*

ãã†ã™ã‚‹ã¨åˆ¥ã®é¸æŠè‚¢ãŒç¾ã‚Œã¾ã™ã€‚ä»Šå›ã¯ Electron ã«é–¢ä¿‚ãªã„ã®ã§ã€Œcreate-vite-extraã€ã‚’é¸æŠã—ã¾ã™ã€‚

![Alt text](/images/vite-library-npm/vite-extra.png)
*create-vite-extraã‚’é¸æŠ*

æœ€å¾Œã«æç¤ºã•ã‚Œã‚‹é …ç›®ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€Œlibraryã€ã‚’é¸æŠã—ã¾ã—ã‚‡ã†ã€‚

![Alt text](/images/vite-library-npm/vite-library.png)
*libraryã‚’é¸æŠ*

ãã†ã™ã‚‹ã¨ã€ä»Šå›ã®ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚ä»Šå›ã¯è©¦é¨“çš„ã«ã€Œninisan-demo-libraryã€ã¨ã„ã†åå‰ã§ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚ã“ã®çŠ¶æ…‹ã§ä¾å­˜è§£æ±ºã¨ã—ãŸå¾Œã« dev ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªç”»é¢ãŒå‡ºã¦ãã‚‹ã¯ãšã§ã™ã€‚

![Alt text](/images/vite-library-npm/vite_ts.png)

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç·¨é›†

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã¨ã€ãƒ«ãƒ¼ãƒˆã«`src/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨`lib/`ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚

- `src/`: dev ã‚µãƒ¼ãƒã§ç«‹ã¡ä¸ŠãŒã‚‹ Web ãƒ•ãƒ­ãƒ³ãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- `lib/`: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæœ¬ä½“ã€‚`src/`ã§å‚ç…§ã•ã‚Œã¦ã„ã‚‹

ã“ã®çŠ¶æ…‹ã‹ã‚‰å°‘ã—æ•´ç†ã—ã¦ã€æœ€çµ‚çš„ã«æ¬¡ã«ç¤ºã™ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã«æ•´ç†ã—ã¦ã¿ã¾ã—ãŸã€‚

```txt: ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 
/
â”œâ”€ lib/
â”‚    â”œâ”€ api.ts
â”‚    â””â”€ index.s
â”œâ”€ src/
â”‚    â””â”€ main.ts
â”œâ”€ tsconfig.ts
â””â”€ package.json
```

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæœ¬ä½“ã§ã¯ã€å˜ç´”ã« 2 æ•°ã‚’åŠ ç®—ã™ã‚‹`add`é–¢æ•°ã¨å¼•æ•°ã®æ–‡å­—åˆ—ã«å¯¾ã—ã¦ã‚ã„ã•ã¤ã™ã‚‹æ–‡å­—åˆ—ã‚’è¿”ã™`sayHello`é–¢æ•°ã‚’å®Ÿè£…ã—ã€å¤–éƒ¨ã¸å…¬é–‹ã—ã¾ã—ãŸã€‚
ã¾ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦`lib/index.ts`ã‚’ç”¨æ„ã—ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§å…¬é–‹ã—ãŸã„ API ã‚’è¨˜è¿°ã—ã¾ã—ãŸã€‚

```ts: lib/api.ts
export const add = (a: number, b: number) => a + b;

export const sayHello = (name: string) => `Hello, ${name}!`;
```

```ts: lib/index.ts
export * from "./api";
```

ãã—ã¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ä½œæˆã—ãŸ 2 ã¤ã®é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã€å®Ÿéš›ã« Web ãƒšãƒ¼ã‚¸ä¸Šã§å®Ÿè¡Œçµæœã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```ts: src/main.ts
import { add, sayHello } from "../lib";

const result = add(1, 2);
const message = sayHello("Alice");

const resultView = document.getElementById(
  "result"
) as HTMLParagraphElement | null;

const messageView = document.getElementById(
  "message"
) as HTMLParagraphElement | null;

if (resultView && messageView) {
  resultView.textContent = `1+2=${result}`;
  messageView.textContent = `message is "${message}"`;
}
```

HTML ã¨ CSS ã‚’é©å½“ã«æ•´ãˆã¦çµæœã‚’è¡¨ç¤ºã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚æ„å›³ã—ãŸã¨ãŠã‚Šã«å‹•ã„ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã­ã€‚

![result](/images/vite-library-npm/result-page.png)

## å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡ºåŠ›

ã“ã®æ™‚ç‚¹ã§æ—¢ã«ã€ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ 2 ã¤ã®é–¢æ•°ã‚’å«ã‚“ã ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã¾ã™ãŒã€å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã«ã¯å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚TypeScript ã§ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ã€å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ä»•çµ„ã¿ã‚’å°å…¥ã—ã¾ã—ã‚‡ã†ã€‚

### tsconfigã®ç·¨é›†

ã¾ãšã¯`tsconfig.ts`ã®è¨­å®šã‚’ã—ã¾ã™ã€‚æ¬¡ã«ç¤ºã™ã‚ˆã†ãªå¤‰æ›´ã‚’åŠ ãˆã¾ã—ã‚‡ã†ã€‚

```diff json: tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "Bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
-    "noEmit": true,
+    // "noEmit": true,
+    "declaration": true,
+    "emitDeclarationOnly": true,
+    "outDir": "./dist",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
-  "include": ["src"]
+  "include": ["lib"]
}
```

### pluginã«ã‚ˆã‚‹å‹å®šç¾©ã®å‡ºåŠ›

ãƒ“ãƒ«ãƒ‰æ™‚ã«å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã•ã›ã‚‹ã«ã¯ã„ãã¤ã‹æ–¹æ³•ãŒã‚ã‚Šã€tsc å˜ä½“ã§å‡ºåŠ›ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚‹ã®ã§ã™ãŒã€ä»Šå›ã¯ Vite ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã„ã¾ã™ã€‚æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§`vite-plugin-dts`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚

```bash
pnpm add -D vite-plugin-dts
```

ãã—ã¦`vite.config.ts`ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šã‚’è¿½è¨˜ã—ã¾ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆãŒå¤‰ã‚ã£ãŸã“ã¨ã«ã‚ˆã‚Šã€Vite ã® lib ãƒ¢ãƒ¼ãƒ‰ã§å‡ºåŠ›ã™ã‚‹éš›ã®è¨­å®šã‚‚å¤‰ã‚ã£ã¦ã„ã¾ã™ã®ã§åˆã‚ã›ã¦ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

```ts: vite.config.ts
import { defineConfig } from "vite";
import dts from "vite-plugin-dts";
import { resolve } from "path";

export default defineConfig({
  plugins: [dts()],
  build: {
    lib: {
      entry: resolve(__dirname, "./lib/index.ts"),
      name: "ninisan-demo", // ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åå‰ã«å¤‰æ›´
      fileName: "index",
      formats: ["es", "umd"],
    },
  },
});
```

ã“ã®çŠ¶æ…‹ã§`pnpm build`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ç„¡äº‹ã«`dist/`ä»¥ä¸‹ã«å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚

![dts-dist](/images/vite-library-npm/dts-dist-vite.png)

## npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å…¬é–‹

æœ€å¾Œã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å…¬é–‹ã®ãŸã‚ã®è¨­å®šã‚„å‹•ä½œç¢ºèªã‚’ã—ã¦ã„ãã¾ã™ã€‚

### package.jsonã®ç·¨é›†

npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹éš›ã«ã¯ã€`package.json`ã¸ã„ãã¤ã‹è¨­å®šã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Vite ã® library ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯æ—¢ã« main, module, types ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã©ã®è¨­å®šãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ãŒã€ä»Šå›ã¯å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚„å‡ºåŠ›ã•ã‚Œã‚‹ JS ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ãŒå¤‰ã‚ã£ã¦ã„ã‚‹ã®ã§ä¿®æ­£ã—ã¾ã—ã‚‡ã†ã€‚
ã¾ãŸã€description ã‚„ homepageã€keywords ãªã©ã®è¦ç´ ã‚‚ä»˜ã‘åŠ ãˆã‚‹ã¨ã¡ã‚ƒã‚“ã¨ã—ãŸ npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã£ã½ã•ãŒå‡ºã¦ãã¾ã™ã€‚ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®è¨˜è¼‰ã‚‚å¿…è¦ã§ã™ã­ã€‚
æœ€çµ‚çš„ã«å‡ºæ¥ä¸ŠãŒã£ãŸ`package.json`ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```json:package.json
{
  "name": "ninisan-demo-library",
  "private": false,
  "version": "0.1.0",
  "description": "ninisan's demo npm package",
  "author": "drumath2237",
  "homepage": "https://github.com/drumath2237/ninisan-demo-library",
  "license": "Apache-2.0",
  "keywords": [
    "npm",
    "typescript"
  ],
  "packageManager": "pnpm@8.12.1",
  "repository": {
    "type": "git",
    "url": "https://github.com/drumath2237/ninisan-demo-library"
  },
  "type": "module",
  "files": [
    "dist"
  ],
  "main": "./dist/index.umd.cjs",
  "module": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    "types": "./dist/index.d.ts",
    "import": "./dist/index.js",
    "require": "./dist/index.umd.cjs"
  },
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "prepare": "pnpm build"
  },
  "devDependencies": {
    "@types/node": "^20.10.5",
    "typescript": "^5.3.3",
    "vite": "^5.0.10",
    "vite-plugin-dts": "^3.7.0"
  }
}
```

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®å‹•ä½œãƒ†ã‚¹ãƒˆã¨å…¬é–‹

ã‚ã¨ã¯å…¬é–‹ã™ã‚‹ã ã‘ã§ã™ãŒã€ä¸€å¿œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‹•ä½œç¢ºèªã‚’ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦å…¬é–‹ã™ã‚‹å‰ã ã¨ã—ã¦ã‚‚ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«ã‚ˆã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œã‚’ç¢ºèªã§ãã¾ã™ã€‚ä»Šå›ã¯ pnpm ã‚’ä½¿ã£ãŸæ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã™ãŒã€npm ã‚„ yarn ã«ã‚‚åŒæ§˜ã®æ©Ÿèƒ½ã¯å­˜åœ¨ã—ã¾ã™ã€‚

ã¾ãšã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã—ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆpackage.json ãŒã‚ã‚‹éšå±¤ï¼‰ã§å®Ÿè¡Œã—ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«ç’°å¢ƒã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’å¼µã‚Šã¾ã—ã‚‡ã†ã€‚

```bash
# ãƒ“ãƒ«ãƒ‰
pnpm build

# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è²¼ã‚‹
pnpm link --global
```

æ¬¡ã«é©å½“ãª Web ãƒ•ãƒ­ãƒ³ãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ Vite ãªã©ã§ä½œæˆã—ã€ãã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚

```bash
pnpm link --global <ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å>
```

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ package.json ã«è¨˜è¼‰ã—ãŸåå‰ã‚’ä½¿ã„ã¾ã™ã€‚
ä»Šå›ã¯ç°¡å˜ãª Vanilla-TypeScript ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ Vite ã§ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚
ã‚³ãƒ¼ãƒ‰ä¸Šã§é€šå¸¸é€šã‚Šã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä½¿ã£ã¦è¦‹ã¾ã™ã€‚å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã—ã¦ã„ã‚‹ã®ã§å‹è£œå®Œã‚‚ã•ã‚Œã¦ã„ã¾ã™ã­ã€‚

```ts
// ä¸­ç•¥
import { add, sayHello } from "ninisan-demo-library";

const result = add(1, 2);
const msg = sayHello("Bob");

document.querySelector<HTMLDivElement>("#app")!.innerHTML = `
  <div>
    <h1>1+2=${result}, "${msg}"</h1>
    <div class="card">
      <button id="counter" type="button"></button>
    </div>
    <p class="read-the-docs">
      Click on the Vite and TypeScript logos to learn more
    </p>
  </div>
`;
```

ãã†ã—ã¦ dev ã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãª Web ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚ã©ã†ã‚„ã‚‰ã¡ã‚ƒã‚“ã¨å‹•ã„ã¦ã„ã‚‹ã¿ãŸã„ã§ã™ã­ã€‚

![local-test-link](/images/vite-library-npm/local-link-test.png)

æœ€å¾Œã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æˆ»ã£ã¦æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚Œã° npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã§ãã¾ã™ã€‚

```bash
npm publish
```

## ãŠã‚ã‚Šã«

### ã¾ã¨ã‚

æœ¬è¨˜äº‹ã§ã¯ Vite ã® library ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã€ã•ã‚‰ã«å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹è¨­å®šã‚‚è¿½åŠ ã—ã¾ã—ãŸã€‚ç°¡å˜ãªãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘ npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã‚‹ã«ã¯æ¯”è¼ƒçš„ã‚µã‚¯ãƒƒã¨è©¦ã›ã‚‹æ–¹æ³•ã§ã™ã®ã§ã€ãœã²ã©ã“ã‹ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

### å‚è€ƒæ–‡çŒ®

https://github.com/drumath2237/ninisan-demo-library

https://pnpm.io/ja/cli/link#pnpm-link---global

https://github.com/qmhc/vite-plugin-dts

https://zenn.dev/s_takashi/articles/20ecebd0a42010

https://zenn.dev/drumath2237/articles/8f4c10a93ca65e