---
title: "3D Gaussian Splattingãƒ­ãƒ¼ãƒ€ãƒ©ã‚¤ãƒ–ãƒ©ãƒª\"spz-loader\"ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸ"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["gaussiansplatting", "webassembly", "typescript", "pnpm", "monorepo"]
published: false
---

:::message
ã“ã®è¨˜äº‹ã¯[ã«ãƒ¼å…„ã•ã‚“ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼2024](https://qiita.com/advent-calendar/2024/ninisan-2024)ã®1æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚
:::

## ã¯ã˜ã‚ã«

### TL;DR

GaussianSplatting ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä¸€ç¨®ã§ã‚ã‚‹.spz ãƒ•ã‚¡ã‚¤ãƒ«ã®ãŸã‚ã®ãƒ­ãƒ¼ãƒ€ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸã€‚

### æ¦‚è¦

æœ¬è¨˜äº‹ã§ã¯ã€æœ€è¿‘ç­†è€…ãŒãƒªãƒªãƒ¼ã‚¹ã—ãŸ spz-loader ã¨ã„ã† npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ¦‚è¦ã‚’ã”ç´¹ä»‹ã™ã‚‹å†…å®¹ã¨ãªã£ã¦ã„ã¾ã™ã€‚
å€‹ã€…ã®æŠ€è¡“ã«é–¢ã—ã¦ã®ç´°ã‹ã„å†…å®¹ã«ã¤ã„ã¦ã¯åˆ¥ã®è¨˜äº‹ã«ã¦ç´¹ä»‹ã™ã‚‹æ–¹é‡ã§ã€
ã¨ã‚Šã‚ãˆãšã“ã®è¨˜äº‹ã§ã¯ã–ã£ãã‚Šã¨ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å…¨ä½“åƒã‚’ã”ç´¹ä»‹ã§ãã‚Œã°ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

## spz-loaderã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸğŸ‰

11/28 ã« spz-loader ã® v0.1.0 ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸã€‚

https://github.com/drumath2237/spz-loader/releases/tag/v0.1.0

spz-loader ã¯åå‰ã®é€šã‚Šã€SPZ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãŒã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

## spzãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã¯

SPZ ã¯ Niantic ãŒç­–å®šã™ã‚‹ 3D Gaussian Splatting ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã€
æ—¢å­˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚ˆã‚Šã‚‚åœ§ç¸®ç‡ãŒé«˜ã„ã¨ã„ã†ç‰¹å¾´ã‚’æŒã¡ã¾ã™ã€‚
è©³ç´°ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã¤ã„ã¦ã¯å…¬å¼ãƒ–ãƒ­ã‚°ã«è§£èª¬ãŒã‚ã‚Šã¾ã™ã€‚

https://scaniverse.com/news/spz-gaussian-splat-open-source-file-format

ãƒ–ãƒ­ã‚°ã«ã‚‚æ›¸ã„ã¦ã‚ã‚‹é€šã‚Šã€GaussianSplatting ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã€æ¬¡ã®ã‚ˆã†ãªå·¥å¤«ã‚’ã—ã¦ã„ã¾ã™ã€‚

- å„ãƒ‡ãƒ¼ã‚¿ã‚’ãã®æ€§è³ªã«åŸºã¥ã„ã¦é©åˆ‡ãªç²¾åº¦ã«åã‚ã¦ã„ã‚‹
  - å¾“æ¥ä½¿ã‚ã‚Œã¦ã„ãŸ.ply ã§ã¯ã™ã¹ã¦ double ã‚„ float ã§ä¿æŒã—ã¦ã„ãŸ
- gzip ã§åœ§ç¸®ã—ã¦ã„ã‚‹
  - åˆ—ãƒ™ãƒ¼ã‚¹ã§ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¦ã„ã‚‹ãŸã‚åœ§ç¸®åŠ¹ç‡ãŒè‰¯ã„ã‚‰ã—ã„

ã‚‚ã¨ã‚‚ã¨ã€GaussianSplatting ã«ä½¿ã‚ã‚Œã¦ããŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã„ã†ã®ã¯
è‰²ã€…ãªã‚‚ã®ãŒã‚ã‚Šã¾ã—ãŸã€‚
ä¸€ç•ªã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãªã®ã¯åŸè‘—è«–æ–‡ã§ã‚‚ä½¿ç”¨ã•ã‚Œã¦ã„ãŸ PLY ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ãŒã€
ä»–ã«ã‚‚ Compressed PLY, splat, ksplat ãªã©ã¨ã„ã£ãŸç‹¬è‡ªã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚‚å­˜åœ¨ã—ã¾ã™ã€‚
ãã†ã„ã†çŠ¶æ³ä¸‹ã§ã¯ã€GaussianSplatting ã‚’æ‰±ã†ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯è¤‡æ•°ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¯¾å¿œã—ãªãã¦ã¯ãªã‚‰ãšã€
ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æ¬²ã™ã‚‹å£°ã‚‚ä¸ŠãŒã£ã¦ã„ã¾ã—ãŸã€‚

ãã‚“ãªä¸­ã€Niantic ã¯ SPZ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ææ¡ˆã—ã¾ã™ã€‚
ãã—ã¦æ—¢ã« SPZ ã¯åŒç¤¾ãŒæä¾›ã™ã‚‹ Scaniverse ã‚„ Niantic Studio ã¨ã„ã£ãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚
ç­†è€…ã¨ã—ã¦ã¯ã€SPZ ã®ç™»å ´ã«ã‚ˆã‚Š GaussianSplatting ãƒ‡ãƒ¼ã‚¿ã®æ¨™æº–åŒ–ãŒé€²ã‚€ã¨å¬‰ã—ã„ã§ã™ã€‚

## spz-loaderã§ã§ãã‚‹ã“ã¨

spz-loader ã¯è¤‡æ•°ã® npm ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰æ§‹æˆã•ã‚Œã¾ã™ã€‚
ã¨ã¯è¨€ã£ã¦ã‚‚ v0.1.0 ã§ã¯æ¬¡ã® 2 ã¤ã®ã¿ã§ã™ã€‚

- core ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- Babylon.js ç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

### coreãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯`@spz-loader/core`ã§ã™ã€‚
core ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ SPZ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€ãƒ”ãƒ¥ã‚¢ãª JavaScript Object ã¸ã®å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã‚’æä¾›ã—ã¾ã™ã€‚ä½¿ç”¨æ„Ÿã¨ã—ã¦ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```ts:coreãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½¿ç”¨ä¾‹
import { loadSpz } from "@spz-loader/core";

import spzUrl from "../assets/racoonfamily.spz?url";

const spzBuffer = await fetch(spzUrl)
  .then((res) => res.arrayBuffer())
  .then((buf) => new Uint8Array(buf));

const splat = await loadSpz(spzBuffer);

console.log(splat.numPoints);
```

`loadSpz`é–¢æ•°ã«ãƒãƒƒãƒ•ã‚¡ã‚’æ¸¡ã™ã¨`GaussianCloud`å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¿”å´ã•ã‚Œã‚‹æ„Ÿã˜ã§ã™ã€‚
ã“ã® GaussianCloud ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®šç¾©æ¬¡ã®é€šã‚Šã«ãªã£ã¦ãŠã‚Šã€
åŸºæœ¬çš„ã«æœ¬å®¶ nianticlabs/spz ã®å®šç¾©ã¨ä¼¼ãŸã‚ˆã†ãªã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚

```ts:GaussianCloudã®å®šç¾©
export type GaussianCloud = {
  numPoints: number;
  shDegree: number;
  antialiased: boolean;
  positions: Float32Array;
  scales: Float32Array;
  rotations: Float32Array;
  alphas: Float32Array;
  colors: Float32Array;
  sh: Float32Array;
};
```

  https://github.com/nianticlabs/spz/blob/bf305418722bb0663a3074f3828699df44b8c1d2/src/cc/splat-types.h#L29-L54

### Babylon.jsç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯`@spz-loader/babylonjs`ã§ã™ã€‚

## spz-loaderã§æ¡ç”¨ã•ã‚Œã¦ã„ã‚‹æŠ€è¡“

### Niantic/spzã®wasmã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

### wasmã‚’å«ã‚“ã npmãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### pnpm-workspaceã‚’ç”¨ã„ãŸãƒ¢ãƒãƒ¬ãƒæ§‹æˆ

### lerna-liteã«ã‚ˆã‚‹ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼

## ãŠã‚ã‚Šã«

### å‚è€ƒæ–‡çŒ®
