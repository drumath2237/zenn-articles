---
title: "Azure Static Web Appsã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã®ç†è§£ã¨ã€ãã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ–¹æ³•ã«ã¤ã„ã¦"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["azurestaticwebapps", "azure", "githubactions"]
published: false
---

# ã¯ã˜ã‚ã«

## TL;DR

GitHub Actions ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.yml ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’ç·¨é›†ã™ã‚‹ã“ã¨ã§ã€
Azure Static Web Apps ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ§‹æˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

## æœ¬è¨˜äº‹ã®æ¦‚è¦

Azure Static Web Appsï¼ˆä»¥ä¸‹ Azure SWAï¼‰ã¯é™çš„ãª Web ãƒšãƒ¼ã‚¸ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ãã‚‹ Azure ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
GitHub ãƒªãƒã‚¸ãƒˆãƒªã¨é€£æºã™ã‚‹ã¨è‡ªå‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã®è¨­å®šãŒã•ã‚Œã‚‹ãŸã‚ã€æ‰‹è»½ã« Web ãƒšãƒ¼ã‚¸ã‚’å…¬é–‹ã§ãã‚‹ä¾¿åˆ©ãªã‚µãƒ¼ãƒ“ã‚¹ã«ãªã£ã¦ã„ã¾ã™ã€‚
https://learn.microsoft.com/ja-jp/azure/static-web-apps/overview

Azure SWA ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯ GitHub Actions ãŒä½¿ã‚ã‚Œã¾ã™ãŒã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ã§è¿½åŠ ã—ã¦ãã‚Œã‚‹ã®ã§é–‹ç™ºè€…ãŒç›´æ¥ .yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰‹æ›¸ãã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãã®ãŸã‚ã€å…·ä½“çš„ã«ã©ã‚“ãªãƒ‡ãƒ—ãƒ­ã‚¤æ§‹æˆã«ãªã£ã¦ã„ã‚‹ã‹ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã¯å°‘ãªã„ã§ã—ã‚‡ã†ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€ã‚‚ã— Azure SWA ã§ãƒ‡ãƒ—ãƒ­ã‚¤æ§‹æˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸããªã£ãŸã¨ãã«
ã©ã®ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã‘ã°ã‚ˆã„ã®ã‹ã‚’è§£èª¬ã—ã¾ã™ã€‚
å®Ÿã¯æœ¬è¨˜äº‹ã§èª¬æ˜ã™ã‚‹äº‹é …ã¯ã™ã¹ã¦æ¬¡ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¾ã¨ã¾ã£ã¦ã„ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚‚åˆã‚ã›ã¦ã”å‚ç…§ãã ã•ã„ã€‚
https://learn.microsoft.com/ja-jp/azure/static-web-apps/build-configuration?tabs=github-actions
ã¾ãŸã€æœ¬è¨˜äº‹ã§ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦ã®ã¿è§£èª¬ã™ã‚‹ãŸã‚ã€API éƒ¨åˆ†ã®èª¬æ˜ã¯çœã„ã¦ãŠã‚Šã¾ã™ã€‚

## å¯¾è±¡èª­è€…

- Azure SWA ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã„æ–¹
- Web ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºçµŒé¨“ãŒã‚ã‚‹æ–¹
- Azure SWA ã‚’çŸ¥ã£ã¦ã„ã‚‹æ–¹
- GitHub Actions ã‚’ä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹æ–¹

## æƒ³å®šç’°å¢ƒ

ç‰¹ã«ã‚µãƒ³ãƒ—ãƒ«ãªã©ã‚’ç”¨æ„ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€
æœ¬è¨˜äº‹ã§ã¯**Node.js ã«ã‚ˆã£ã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ Web ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºç’°å¢ƒ**ã‚’æƒ³å®šã—ã¦æ›¸ã„ã¦ãŠã‚Šã¾ã™ã€‚
ä¾‹ãˆã° React ã‚„ Vue ã¨ã„ã£ãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å°å…¥ã—ã¦ã„ãŸã‚Šã€ Vite ã‚„ Webpack ã§ãƒ“ãƒ«ãƒ‰ã—ãŸã‚Šã™ã‚‹ã‚¿ã‚¤ãƒ—ã®ç’°å¢ƒãŒè©²å½“ã—ã¾ã™ã€‚
Azure SWA ã§ã¯ Blazor ãªã©ã®ç’°å¢ƒã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ãŒã€ã‚‚ã—ãã¡ã‚‰ã‚’ã”åˆ©ç”¨ã•ã‚Œã‚‹éš›ã«ã¯é©å®œå†…å®¹ã‚’èª­ã¿æ›¿ãˆã¦ã„ãŸã ããŸã„ã§ã™ã€‚

# ãƒ‡ãƒ—ãƒ­ã‚¤æ§‹æˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

## ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ§‹æˆ

ä¾‹ãˆã° create-vite ã‚’ä½¿ã£ã¦ Vue ï¼‹ TypeScript ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹ã¨æ¬¡ã®ã‚ˆã†ãª`package.json`ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```json:package.json
{
  "name": "test-vite-vue",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc --noEmit && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.2.37"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^3.1.0",
    "typescript": "^4.6.4",
    "vite": "^3.1.0",
    "vue-tsc": "^0.40.4"
  }
}
```

ãã—ã¦ä¾‹ãˆã°`yarn build`ã¨ã„ã£ãŸã‚³ãƒãƒ³ãƒ‰ã‚’ãŸãŸãã¨ã€`/dist`ä»¥ä¸‹ã«ãƒ“ãƒ«ãƒ‰æˆæœç‰©ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
ã“ã®ã‚ˆã†ãªæ§‹æˆã®å ´åˆã€Azure SWA ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹éš›ã«ã¯æ¬¡ã®ã‚ˆã†ã«è¨­å®šé …ç›®ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

![img](/images/aswa-custom-deploy/swa-setup.png)

ã“ã®è¨­å®šã§ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã¨ã€`.github\workflows\azure-static-web-apps-{ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—}.yml`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚å†…å®¹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```yml
name: Azure Static Web Apps CI/CD

on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, synchronize, reopened, closed]
    branches:
      - main

jobs:
  build_and_deploy_job:
    if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.event.action != 'closed')
    runs-on: ubuntu-latest
    name: Build and Deploy Job
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: true
      - name: Build And Deploy
        id: builddeploy
        uses: Azure/static-web-apps-deploy@v1
        with:
          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ— }}
          repo_token: ${{ secrets.GITHUB_TOKEN }} # Used for Github integrations (i.e. PR comments)
          action: "upload"
          ###### Repository/Build Configurations - These values can be configured to match your app requirements. ######
          # For more information regarding Static Web App workflow configurations, please visit: https://aka.ms/swaworkflowconfig
          app_location: "/" # App source code path
          api_location: "" # Api source code path - optional
          output_location: "dist" # Built app content directory - optional
          ###### End of Repository/Build Configurations ######
          # ä»¥ä¸‹å‰²æ„›
```

.yml ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã§ã¯ Node.js ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯ã—ã¦ã„ã¾ã›ã‚“ã—ã€ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æŒ‡å®šã‚‚ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€ãƒ­ã‚°ã‚’è¦‹ã‚‹ã¨ã¡ã‚ƒã‚“ã¨`yarn run build`ã¨å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã—ãŸã€‚ã©ã†ã„ã†ã“ã¨ã§ã—ã‚‡ã†ã€‚

Azure SWA ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯æœ€åˆã«ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆ¤åˆ¥ã—ã€Node.js ã‚„.NET ã¨ã„ã£ãŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™ã€‚
ãã®å¾Œ Node.js ã ã£ãŸå ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ **ã€Œ`build`ã¾ãŸã¯`build:azure`ã‚’å®Ÿè¡Œã™ã‚‹ã€** ã¨æ±ºã‚ã‚‰ã‚Œã¦ãŠã‚Šã€ä»Šå›ã®å ´åˆã¯`package.json`ã§`build`ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚å®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚

ã¡ãªã¿ã«`build:azure`ã‚‚ä¸€ç·’ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã¨ã€ã©ã¡ã‚‰ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ã¿ãŸã„ã§ã™ã€‚è‡ªåˆ†ã®ç’°å¢ƒã§ã¯`build`â†’`build:azure`ã¨ã„ã†é †ç•ªã§ã—ãŸã€‚
ã¦ã£ãã‚Š`build:azure`ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹ã®ã‹ãªãã¨æ€ã£ã¦ã„ãŸã®ã§ã“ã‚Œã¯æ„å¤–ã§ã—ãŸã­ã€‚

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹

### ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã ã¨`yarn run build`ã‚‚ã—ãã¯`yarn run build:azure`ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã¯å‰è¿°ã®ã¨ãŠã‚Šã§ã™ãŒã€åˆ¥ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã„ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚
ä¾‹ãˆã° Next.js ã‚„ Nuxt.js ã¨ã„ã£ãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ SSG ã‚’è¡Œã†éš›ã«ã¯`yarn run generate`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã®ãŒæ…£ç¿’ã§ã™ã€‚

Azure SWA ã® actions ã§ã¯ã€`app_build_command`ã«ã‚ˆã£ã¦å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

```diff yml
  - name: Build And Deploy
    id: builddeploy
    uses: Azure/static-web-apps-deploy@v1
    with:
      azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ— }}
      repo_token: ${{ secrets.GITHUB_TOKEN }} # Used for Github integrations (i.e. PR comments)
      action: "upload"
      ###### Repository/Build Configurations - These values can be configured to match your app requirements. ######
      # For more information regarding Static Web App workflow configurations, please visit: https://aka.ms/swaworkflowconfig
      app_location: "/" # App source code path
      api_location: "" # Api source code path - optional
      output_location: "dist" # Built app content directory - optional
+     app_build_command: "yarn generate" # generateã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
      ###### End of Repository/Build Configurations ######
```

### åˆ¥ã® Step ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ã‚’ä»–ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè¡Œã—ãŸã„å ´åˆã‚‚ã‚ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚
ä¾‹ãˆã°è‡ªåˆ†ã®å ´åˆã€ Nuxt.js ã®ç’°å¢ƒã‚’ docker-compose ã§æ§‹ç¯‰ã—ã¦ã„ãŸã®ã§ã€
Docker ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒˆã‚’ã—ãŸã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã—ãŸã€‚

ãã†ã„ã†å ´åˆã¯`skip_app_build`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ true ã«ã™ã‚‹ã“ã¨ã§å¯¾å¿œã§ãã¾ã™ã€‚
ä¾‹ãˆã°`Azure/static-web-apps-deploy`ã‚’å®Ÿè¡Œã™ã‚‹å‰ã« docker-compose ã§é™çš„ã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒˆã‚’è¡Œã£ãŸã†ãˆã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚ˆã†ãª yml ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆä¸€éƒ¨æŠœç²‹ï¼‰ã€‚

```yml
- name: Build with docker-compose
  run: |
    docker-compose up -d
    docker-compose exec -T app yarn install
    docker-compose exec -T app yarn generate

- name: Build And Deploy
  id: builddeploy
  uses: Azure/static-web-apps-deploy@v1
  with:
    azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ— }}
    repo_token: ${{ secrets.GITHUB_TOKEN }} # Used for Github integrations (i.e. PR comments)
    action: "upload"
    ###### Repository/Build Configurations - These values can be configured to match your app requirements. ######
    # For more information regarding Static Web App workflow configurations, please visit: https://aka.ms/swaworkflowconfig
    skip_app_build: true
    app_location: "/src/.output/public" # App source code path
    api_location: "" # Api source code path - optional
    output_location: "" # Built app content directory - optional
    ###### End of Repository/Build Configurations ######
```

ã“ã“ã§ãƒã‚¤ãƒ³ãƒˆã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

- `skip_app_build`ãŒ true ã«ãªã£ã¦ã„ã‚‹
- `app_location`ãŒãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãªã£ã¦ã„ã‚‹
- `output_location`ãŒç©ºæ–‡å­—ã«ãªã£ã¦ã„ã‚‹

# ãŠã‚ã‚Šã«

## å‚è€ƒæ–‡çŒ®

https://learn.microsoft.com/ja-jp/azure/static-web-apps/build-configuration?tabs=github-actions
